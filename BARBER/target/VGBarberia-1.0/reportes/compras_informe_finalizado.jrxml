<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="InformeGeneralComprasFinalizadas" language="groovy" pageWidth="595" pageHeight="842" columnWidth="555" leftMargin="20" rightMargin="20" topMargin="20" bottomMargin="20" uuid="ccc7d23b-f828-435e-ab0e-4eb202349ab2">
	<property name="ireport.zoom" value="1.0"/>
	<property name="ireport.x" value="0"/>
	<property name="ireport.y" value="0"/>
	<parameter name="fecha_desde" class="java.util.Date">
		<defaultValueExpression><![CDATA[]]></defaultValueExpression>
	</parameter>
	<parameter name="fecha_hasta" class="java.util.Date">
		<defaultValueExpression><![CDATA[]]></defaultValueExpression>
	</parameter>
	<queryString>
		<![CDATA[SELECT 
    to_char(c.fecha, 'DD-MM-YYYY') AS fecha_formateada, 
    p.nombre AS proveedor, 
    p.ruc, 
    c.total, 
    c.id,
    -- Sumar el total de las compras finalizadas en el rango de fechas
    SUM(c.total) OVER () AS suma_total_compras,  -- Suma total de todas las compras en el rango de fechas
    
    -- Incluir las fechas 'Desde' y 'Hasta' como parámetros dinámicos
    to_char($P{fecha_desde}::date, 'DD-MM-YYYY') AS fecha_desde, 
    to_char($P{fecha_hasta}::date, 'DD-MM-YYYY') AS fecha_hasta
    
FROM 
    compras c 
JOIN 
    proveedores p ON c.id_proveedor = p.id_proveedor 
WHERE 
    c.estado = 'Finalizado' 
    AND c.fecha BETWEEN $P{fecha_desde}::date AND $P{fecha_hasta}::date
ORDER BY c.fecha;
]]>
	</queryString>
	<field name="fecha_formateada" class="java.lang.String"/>
	<field name="proveedor" class="java.lang.String"/>
	<field name="ruc" class="java.lang.String"/>
	<field name="total" class="java.lang.Integer"/>
	<field name="id" class="java.lang.Integer"/>
	<field name="suma_total_compras" class="java.lang.Long"/>
	<field name="fecha_desde" class="java.lang.String"/>
	<field name="fecha_hasta" class="java.lang.String"/>
	<title>
		<band height="117" splitType="Stretch">
			<staticText>
				<reportElement x="-3" y="10" width="555" height="65" uuid="ace034e1-80be-4732-b470-ccb8f7c01138"/>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Century Gothic" size="24" isBold="true"/>
				</textElement>
				<text><![CDATA[INFORME GENERAL DE COMPRAS FINALIZADAS]]></text>
			</staticText>
			<staticText>
				<reportElement x="26" y="85" width="100" height="20" uuid="ec23eaf4-bce0-4391-b84e-0cc61e4ce7c3"/>
				<textElement>
					<font fontName="Century Gothic" isBold="true"/>
				</textElement>
				<text><![CDATA[FECHA INICIO]]></text>
			</staticText>
			<textField>
				<reportElement x="126" y="85" width="100" height="20" uuid="af8824c6-6ab4-41bd-af63-c394c8a3b4ae"/>
				<textFieldExpression><![CDATA[$F{fecha_desde}]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement x="230" y="85" width="100" height="20" uuid="372e8a81-2a98-4818-89e7-eb7f76b1e20a"/>
				<textElement>
					<font fontName="Century Gothic" isBold="true"/>
				</textElement>
				<text><![CDATA[FECHA FIN ]]></text>
			</staticText>
			<textField>
				<reportElement x="330" y="85" width="100" height="20" uuid="95ed66bb-2815-4757-adc4-a40c62bd2f43"/>
				<textFieldExpression><![CDATA[$F{fecha_hasta}]]></textFieldExpression>
			</textField>
		</band>
	</title>
	<pageHeader>
		<band height="45" splitType="Stretch">
			<rectangle>
				<reportElement x="0" y="10" width="555" height="32" uuid="0df385c0-dcc9-485f-be4b-e4b1332d281c"/>
			</rectangle>
			<staticText>
				<reportElement x="226" y="12" width="100" height="20" uuid="364f136b-705c-4381-b240-b73cd8a1b22f"/>
				<textElement>
					<font fontName="Century Gothic" isBold="true"/>
				</textElement>
				<text><![CDATA[PROVEEDOR]]></text>
			</staticText>
			<staticText>
				<reportElement x="465" y="12" width="52" height="20" uuid="00a44391-a957-4040-9dd6-ef1f7c216171"/>
				<textElement>
					<font fontName="Century Gothic" isBold="true"/>
				</textElement>
				<text><![CDATA[TOTAL]]></text>
			</staticText>
			<staticText>
				<reportElement x="115" y="12" width="60" height="20" uuid="86218ca7-1de5-4241-b0d4-167b09b0d678"/>
				<textElement>
					<font fontName="Century Gothic" isBold="true"/>
				</textElement>
				<text><![CDATA[FECHA]]></text>
			</staticText>
			<staticText>
				<reportElement x="33" y="12" width="31" height="20" uuid="ea08e86b-1d1a-4451-818b-a2789209f045"/>
				<textElement>
					<font fontName="Century Gothic" isBold="true"/>
				</textElement>
				<text><![CDATA[COD]]></text>
			</staticText>
			<staticText>
				<reportElement x="374" y="12" width="29" height="20" uuid="849b7007-9eed-4bdf-95bb-ef17afb341f1"/>
				<textElement>
					<font fontName="Century Gothic" isBold="true"/>
				</textElement>
				<text><![CDATA[RUC]]></text>
			</staticText>
		</band>
	</pageHeader>
	<detail>
		<band height="39" splitType="Stretch">
			<rectangle>
				<reportElement x="1" y="2" width="555" height="32" uuid="2c369fc0-2fda-4e62-8683-29e4166c50c1"/>
			</rectangle>
			<textField>
				<reportElement x="226" y="8" width="100" height="20" uuid="8d4aa271-8893-4570-bf1e-8c7f9e225ca0"/>
				<textFieldExpression><![CDATA[$F{proveedor}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="374" y="8" width="52" height="20" uuid="fa31d278-7922-430c-9241-42f1b3b3036e"/>
				<textFieldExpression><![CDATA[$F{ruc}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="33" y="8" width="31" height="20" uuid="ac775efc-968a-4167-b2e7-7def537a4a06"/>
				<textFieldExpression><![CDATA[$F{id}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="115" y="8" width="60" height="20" uuid="06d633e3-df6b-468c-aa62-dd05d2ef82ed"/>
				<textFieldExpression><![CDATA[$F{fecha_formateada}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="465" y="8" width="87" height="20" uuid="7d5a3add-41c8-4fec-8b6b-0c97b45248d5"/>
				<textFieldExpression><![CDATA[$F{total}]]></textFieldExpression>
			</textField>
		</band>
	</detail>
	<columnFooter>
		<band height="23">
			<rectangle>
				<reportElement x="426" y="0" width="126" height="20" uuid="825c0f72-e5a6-4e25-9dcd-fb3e7d8ab911"/>
			</rectangle>
			<textField>
				<reportElement x="426" y="0" width="122" height="20" uuid="d41be3ae-6e04-41f3-b6c0-5586f551b523"/>
				<textElement textAlignment="Center" verticalAlignment="Middle"/>
				<textFieldExpression><![CDATA[$F{suma_total_compras}]]></textFieldExpression>
			</textField>
		</band>
	</columnFooter>
</jasperReport>
