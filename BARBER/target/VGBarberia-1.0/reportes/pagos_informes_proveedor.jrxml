<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="null" language="groovy" pageWidth="595" pageHeight="842" columnWidth="555" leftMargin="20" rightMargin="20" topMargin="20" bottomMargin="20" uuid="e3bcf01c-c5f1-402e-b952-96a1fdd7f546">
	<property name="ireport.zoom" value="1.0"/>
	<property name="ireport.x" value="0"/>
	<property name="ireport.y" value="0"/>
	<parameter name="fecha_desde" class="java.util.Date">
		<defaultValueExpression><![CDATA[]]></defaultValueExpression>
	</parameter>
	<parameter name="fecha_hasta" class="java.util.Date">
		<defaultValueExpression><![CDATA[]]></defaultValueExpression>
	</parameter>
	<parameter name="id_proveedor" class="java.lang.Integer">
		<defaultValueExpression><![CDATA[]]></defaultValueExpression>
	</parameter>
	<queryString>
		<![CDATA[
	SELECT 
    to_char(v.fecha, 'DD-MM-YYYY') AS fecha_formateada, 
    cl.nombre AS cliente, 
    cc.monto AS monto_cuenta, 
    c.numero AS numero_pago,

    -- Sumar el monto total de las cuentas del cliente
    SUM(cc.monto) OVER (PARTITION BY c.idproveedores) AS suma_total_cuentas_proveedor, 

    -- Fechas fijas como texto en formato 'DD-MM-YYYY'
    to_char($P{fecha_desde}::date, 'DD-MM-YYYY') AS fecha_desde, 
    to_char($P{fecha_hasta}::date, 'DD-MM-YYYY') AS fecha_hasta

FROM 
    pagos c
JOIN 
   proveedores cl ON c.idproveedores = cl.id_proveedor
JOIN 
    compras v ON v.id_proveedor = cl.id_proveedor  -- Relacionamos ventas con clientes
JOIN 
    cuentasproveedores cc ON cc.idcompras = v.id  -- Relacionamos cuentasclientes con ventas
WHERE 
    c.estado = 'FINALIZADO' 
    AND v.fecha BETWEEN $P{fecha_desde}::date AND $P{fecha_hasta} ::date  -- Fechas dinámicas
    AND c.idproveedores =  $P{id_proveedor} -- Parámetro dinámico para el cliente
GROUP BY 
    cl.nombre, cl.ruc, c.numero, c.fecha, cc.monto, c.idproveedores ,v.fecha -- Agrupamos adecuadamente
ORDER BY 
    c.fecha;]]>
	</queryString>
	<field name="fecha_formateada" class="java.lang.String"/>
	<field name="cliente" class="java.lang.String"/>
	<field name="monto_cuenta" class="java.lang.Integer"/>
	<field name="numero_pago" class="java.lang.Integer"/>
	<field name="suma_total_cuentas_proveedor" class="java.lang.Long"/>
	<field name="fecha_desde" class="java.lang.String"/>
	<field name="fecha_hasta" class="java.lang.String"/>
	<title>
		<band height="105" splitType="Stretch">
			<textField>
				<reportElement x="318" y="81" width="100" height="20" uuid="6fe53268-4df9-46bc-91d8-4222b3f7ca02"/>
				<textFieldExpression><![CDATA[$F{fecha_hasta}]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement x="18" y="81" width="100" height="20" uuid="0c8e3004-a6b9-416e-ab13-d41b21ed727f"/>
				<textElement>
					<font isBold="true"/>
				</textElement>
				<text><![CDATA[FECHA INICIO]]></text>
			</staticText>
			<staticText>
				<reportElement x="216" y="81" width="100" height="20" uuid="d8e304a5-6035-40d6-8250-b7b0129218ba"/>
				<textElement>
					<font isBold="true"/>
				</textElement>
				<text><![CDATA[FECHA FIN]]></text>
			</staticText>
			<textField>
				<reportElement x="115" y="81" width="100" height="20" uuid="21a2fd6e-d3e6-4b8c-8bae-625c996a5036"/>
				<textFieldExpression><![CDATA[$F{fecha_desde}]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement x="0" y="16" width="555" height="65" uuid="6c29a378-05b5-433a-afa3-8b1933e884d0"/>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Century Gothic" size="24" isBold="true"/>
				</textElement>
				<text><![CDATA[INFORME  DE PAGOS]]></text>
			</staticText>
		</band>
	</title>
	<columnHeader>
		<band height="35" splitType="Stretch">
			<rectangle>
				<reportElement x="-1" y="3" width="555" height="32" uuid="b50ae23a-b0ca-47aa-93e7-ad9315685693"/>
			</rectangle>
			<staticText>
				<reportElement x="129" y="5" width="60" height="20" uuid="b3a39d23-060a-4d34-aafc-61466b5cd452"/>
				<textElement>
					<font fontName="Century Gothic" isBold="true"/>
				</textElement>
				<text><![CDATA[FECHA]]></text>
			</staticText>
			<staticText>
				<reportElement x="450" y="5" width="52" height="20" uuid="52c5c933-e02b-4077-ac32-d504282ab318"/>
				<textElement textAlignment="Center">
					<font fontName="Century Gothic" isBold="true"/>
				</textElement>
				<text><![CDATA[MONTO]]></text>
			</staticText>
			<staticText>
				<reportElement x="267" y="5" width="100" height="20" uuid="7a8c6825-42e0-4789-a512-ef40b285177e"/>
				<textElement textAlignment="Center">
					<font fontName="Century Gothic" isBold="true"/>
				</textElement>
				<text><![CDATA[PROVEEDOR]]></text>
			</staticText>
			<staticText>
				<reportElement x="22" y="5" width="31" height="20" uuid="67259804-d122-4267-a302-839f689415d8"/>
				<textElement>
					<font fontName="Century Gothic" isBold="true"/>
				</textElement>
				<text><![CDATA[COD]]></text>
			</staticText>
		</band>
	</columnHeader>
	<detail>
		<band height="37" splitType="Stretch">
			<rectangle>
				<reportElement x="1" y="1" width="555" height="32" uuid="ea4c00b1-2ccc-4dd6-ac62-3a5cafd49691"/>
			</rectangle>
			<textField>
				<reportElement x="115" y="1" width="100" height="32" uuid="ceb5e41c-3bf8-4868-aa16-dff2a43b75be"/>
				<textElement textAlignment="Center" verticalAlignment="Middle"/>
				<textFieldExpression><![CDATA[$F{fecha_formateada}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="279" y="1" width="100" height="32" uuid="ac9b5d2d-b121-4fbe-b3d1-bf5cb1245fc9"/>
				<textElement textAlignment="Center" verticalAlignment="Middle"/>
				<textFieldExpression><![CDATA[$F{cliente}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="441" y="1" width="113" height="32" uuid="d4304141-b6ef-4e32-8b71-81a0a96887d7"/>
				<textElement textAlignment="Center" verticalAlignment="Middle"/>
				<textFieldExpression><![CDATA[$F{monto_cuenta}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="21" y="1" width="32" height="29" uuid="b4f35e1b-cd60-4b66-8661-b71fca495ac7"/>
				<textElement textAlignment="Center" verticalAlignment="Middle"/>
				<textFieldExpression><![CDATA[$F{numero_pago}]]></textFieldExpression>
			</textField>
		</band>
	</detail>
	<summary>
		<band height="42" splitType="Stretch">
			<textField>
				<reportElement x="435" y="0" width="119" height="20" uuid="bb5ab067-c81d-4728-97bf-6630fffe93e6"/>
				<textElement textAlignment="Center" verticalAlignment="Middle"/>
				<textFieldExpression><![CDATA[$F{suma_total_cuentas_proveedor}]]></textFieldExpression>
			</textField>
		</band>
	</summary>
</jasperReport>
