<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="null" language="groovy" pageWidth="595" pageHeight="842" columnWidth="555" leftMargin="20" rightMargin="20" topMargin="20" bottomMargin="20" uuid="34b555e9-d67b-4796-9266-6fa18f202571">
	<property name="ireport.zoom" value="1.0"/>
	<property name="ireport.x" value="0"/>
	<property name="ireport.y" value="0"/>
	<parameter name="fecha_desde" class="java.util.Date">
		<defaultValueExpression><![CDATA[]]></defaultValueExpression>
	</parameter>
	<parameter name="fecha_hasta" class="java.util.Date">
		<defaultValueExpression><![CDATA[]]></defaultValueExpression>
	</parameter>
	<parameter name="id_producto" class="java.lang.Integer">
		<defaultValueExpression><![CDATA[]]></defaultValueExpression>
	</parameter>
	<parameter name="id_cliente" class="java.lang.Integer">
		<defaultValueExpression><![CDATA[]]></defaultValueExpression>
	</parameter>
	<queryString>
		<![CDATA[SELECT 
    c.numero, 
    to_char(v.fecha, 'dd-mm-yyyy') AS fecha_formateada, 
    p.descripcion AS producto, 
    dt.cantidad, 
    cc.monto,
    
    -- Suma total de todos los montos de cobros en el rango de fechas
    SUM(cc.monto) OVER () AS suma_total_cobros,  
    
    -- Incluir las fechas 'Desde' y 'Hasta' como parámetros dinámicos
    to_char($P{fecha_desde}::date, 'DD-MM-YYYY') AS fecha_desde, 
    to_char($P{fecha_hasta}::date, 'DD-MM-YYYY') AS fecha_hasta

FROM 
    detalleventas dt
JOIN 
    productos p ON dt.id_producto = p.id_producto
JOIN 
    ventas v ON dt.idventa = v.id
JOIN 
    cuentasclientes cc ON v.id = cc.idventas  -- Relacionamos ventas con cuentasclientes
JOIN 
    cobros c ON c.idclientes = v.id_cliente  -- Relacionamos cobros con clientes
WHERE 
    v.estado = 'Finalizado' 
    AND v.fecha BETWEEN $P{fecha_desde}::date AND $P{fecha_hasta}::date  -- Fechas proporcionadas como parámetros
    AND v.id_cliente = $P{id_cliente}  -- Filtramos por producto específico
ORDER BY 
    v.fecha;
]]>
	</queryString>
	<field name="numero" class="java.lang.Integer"/>
	<field name="fecha_formateada" class="java.lang.String"/>
	<field name="producto" class="java.lang.String"/>
	<field name="cantidad" class="java.lang.Integer"/>
	<field name="monto" class="java.lang.Integer"/>
	<field name="suma_total_cobros" class="java.lang.Long"/>
	<field name="fecha_desde" class="java.lang.String"/>
	<field name="fecha_hasta" class="java.lang.String"/>
	<background>
		<band splitType="Stretch"/>
	</background>
	<title>
		<band height="93" splitType="Stretch">
			<staticText>
				<reportElement x="0" y="5" width="555" height="65" uuid="a8881a7c-64d6-404e-90ec-d498325e8e27"/>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Century Gothic" size="24" isBold="true"/>
				</textElement>
				<text><![CDATA[INFORME  DETALLE COBROS]]></text>
			</staticText>
			<textField>
				<reportElement x="324" y="70" width="100" height="20" uuid="7a2ff736-b6bb-42e3-b79d-a44395b058b7"/>
				<textFieldExpression><![CDATA[$F{fecha_hasta}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="117" y="70" width="100" height="20" uuid="4abb2fae-e5a0-4167-a406-3e86aaef46f4"/>
				<textFieldExpression><![CDATA[$F{fecha_desde}]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement x="26" y="70" width="100" height="20" uuid="04d940d2-6e3c-4b4b-913e-4efc2f3b3592"/>
				<textElement>
					<font isBold="true"/>
				</textElement>
				<text><![CDATA[FECHA INICIO]]></text>
			</staticText>
			<staticText>
				<reportElement x="224" y="70" width="100" height="20" uuid="83765d04-6145-4696-b95f-53def8660dee"/>
				<textElement>
					<font isBold="true"/>
				</textElement>
				<text><![CDATA[FECHA FIN]]></text>
			</staticText>
		</band>
	</title>
	<columnHeader>
		<band height="45" splitType="Stretch">
			<rectangle>
				<reportElement x="1" y="10" width="555" height="32" uuid="305564a2-879e-4deb-a61b-3aab8961e06d"/>
			</rectangle>
			<staticText>
				<reportElement x="345" y="10" width="100" height="32" uuid="7474f0df-c869-435f-9bb1-823d20806e92"/>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Century Gothic" isBold="true"/>
				</textElement>
				<text><![CDATA[CANTIDAD]]></text>
			</staticText>
			<staticText>
				<reportElement x="193" y="10" width="100" height="32" uuid="bfaf7474-583d-4ae1-9009-b7f1fad676e9"/>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Century Gothic" isBold="true"/>
				</textElement>
				<text><![CDATA[PRODUCTO]]></text>
			</staticText>
			<staticText>
				<reportElement x="469" y="10" width="52" height="32" uuid="38cbc10c-6e94-4cf8-8ce9-f17537062345"/>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Century Gothic" isBold="true"/>
				</textElement>
				<text><![CDATA[MONTO]]></text>
			</staticText>
			<staticText>
				<reportElement x="93" y="10" width="60" height="32" uuid="5204602f-4d78-47d2-8f36-965611d5c301"/>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Century Gothic" isBold="true"/>
				</textElement>
				<text><![CDATA[FECHA]]></text>
			</staticText>
			<staticText>
				<reportElement x="22" y="10" width="31" height="32" uuid="b70672de-7b9d-413b-bb45-b19f52acfd56"/>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Century Gothic" isBold="true"/>
				</textElement>
				<text><![CDATA[COD]]></text>
			</staticText>
		</band>
	</columnHeader>
	<detail>
		<band height="38" splitType="Stretch">
			<rectangle>
				<reportElement x="1" y="2" width="555" height="32" uuid="4dacb04d-22a5-4657-a476-cbc145a50244"/>
			</rectangle>
			<textField>
				<reportElement x="80" y="2" width="100" height="32" uuid="22d2cb7b-31d8-4707-81ae-b256f53a3f72"/>
				<textElement textAlignment="Center" verticalAlignment="Middle"/>
				<textFieldExpression><![CDATA[$F{fecha_formateada}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="345" y="2" width="100" height="32" uuid="6aac4c5f-9285-451a-bd52-4a06e7be511d"/>
				<textElement textAlignment="Center" verticalAlignment="Middle"/>
				<textFieldExpression><![CDATA[$F{cantidad}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="25" y="2" width="30" height="33" uuid="15e8cc89-97e5-42f0-835f-966a246a5713"/>
				<textElement textAlignment="Center" verticalAlignment="Middle"/>
				<textFieldExpression><![CDATA[$F{numero}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="193" y="2" width="131" height="33" uuid="4cec3c69-5c02-4b98-8ee3-5b3294853189"/>
				<textElement textAlignment="Center" verticalAlignment="Middle"/>
				<textFieldExpression><![CDATA[$F{producto}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="456" y="2" width="100" height="33" uuid="67e13a3f-d00d-4838-afb6-b6a85a9dec52"/>
				<textElement textAlignment="Center" verticalAlignment="Middle"/>
				<textFieldExpression><![CDATA[$F{monto}]]></textFieldExpression>
			</textField>
		</band>
	</detail>
	<summary>
		<band height="42" splitType="Stretch">
			<staticText>
				<reportElement x="347" y="9" width="100" height="20" uuid="cd91ebfb-2d31-40bd-8c24-d0b0345998b8"/>
				<textElement>
					<font isBold="true"/>
				</textElement>
				<text><![CDATA[TOTAL CON IVA  :]]></text>
			</staticText>
			<textField>
				<reportElement x="455" y="8" width="100" height="20" uuid="47d7153e-cf13-4662-964e-e2afe8cde2ca"/>
				<textElement textAlignment="Center" verticalAlignment="Middle"/>
				<textFieldExpression><![CDATA[$F{suma_total_cobros}]]></textFieldExpression>
			</textField>
		</band>
	</summary>
</jasperReport>
