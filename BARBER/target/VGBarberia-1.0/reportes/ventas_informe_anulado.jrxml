<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="null" language="groovy" pageWidth="595" pageHeight="842" columnWidth="555" leftMargin="20" rightMargin="20" topMargin="20" bottomMargin="20" uuid="ac4eaf65-47e4-4467-94dd-41ecf66d1d64">
	<property name="ireport.zoom" value="1.0"/>
	<property name="ireport.x" value="0"/>
	<property name="ireport.y" value="52"/>
	<parameter name="fecha_desde" class="java.util.Date">
		<defaultValueExpression><![CDATA[]]></defaultValueExpression>
	</parameter>
	<parameter name="fecha_hasta" class="java.util.Date">
		<defaultValueExpression><![CDATA[]]></defaultValueExpression>
	</parameter>
	<queryString>
		<![CDATA[SELECT 
    to_char(v.fecha, 'DD-MM-YYYY') AS fecha_formateada, 
    a.nombre, 
    a.ci, 
    v.total, 
    v.id,
    -- Sumar el total de las ventas finalizadas en el rango de fechas
    SUM(v.total) OVER () AS suma_total_ventas,  -- Suma total de todas las ventas en el rango de fechas
    
    -- Incluir las fechas 'Desde' y 'Hasta' como parámetros dinámicos
    to_char($P{fecha_desde}::date, 'DD-MM-YYYY') AS fecha_desde, 
    to_char($P{fecha_hasta}::date, 'DD-MM-YYYY') AS fecha_hasta
    
FROM 
    ventas v 
JOIN 
    clientes a ON v.id_cliente = a.id_cliente 
WHERE 
    v.estado = 'Anulado' 
    AND v.fecha BETWEEN $P{fecha_desde}::date AND $P{fecha_hasta}::date
ORDER BY v.fecha;]]>
	</queryString>
	<field name="fecha_formateada" class="java.lang.String"/>
	<field name="nombre" class="java.lang.String"/>
	<field name="ci" class="java.lang.String"/>
	<field name="total" class="java.lang.Integer"/>
	<field name="id" class="java.lang.Integer"/>
	<field name="suma_total_ventas" class="java.lang.Long"/>
	<field name="fecha_desde" class="java.lang.String"/>
	<field name="fecha_hasta" class="java.lang.String"/>
	<title>
		<band height="134" splitType="Stretch">
			<staticText>
				<reportElement x="1" y="34" width="555" height="65" uuid="47ffd0c2-6c35-4593-95fb-438e6869d85a"/>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Century Gothic" size="24" isBold="true"/>
				</textElement>
				<text><![CDATA[INFORME GENERAL DE VENTAS ANULADAS]]></text>
			</staticText>
			<staticText>
				<reportElement x="17" y="99" width="100" height="20" uuid="90e745c0-a01c-44e9-9746-f8042b8f0b1b"/>
				<textElement>
					<font isBold="true"/>
				</textElement>
				<text><![CDATA[FECHA INICIO]]></text>
			</staticText>
			<textField>
				<reportElement x="117" y="99" width="100" height="20" uuid="4f24428a-01c2-4145-8b8b-e152016f2c7e"/>
				<textElement>
					<font isBold="false"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{fecha_desde}]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement x="217" y="99" width="100" height="20" uuid="4e402cb8-eb5e-4fa7-9bb3-f9b012ee9e07"/>
				<textElement>
					<font isBold="true"/>
				</textElement>
				<text><![CDATA[FECHA FIN]]></text>
			</staticText>
			<textField>
				<reportElement x="317" y="99" width="100" height="20" uuid="af0129a6-a837-49c7-b6e8-6bf25b4ff0ac"/>
				<textFieldExpression><![CDATA[$F{fecha_hasta}]]></textFieldExpression>
			</textField>
		</band>
	</title>
	<pageHeader>
		<band height="47" splitType="Stretch">
			<rectangle>
				<reportElement x="2" y="15" width="555" height="32" uuid="d41a2813-5ec0-465c-98e8-80c0aeda2731"/>
			</rectangle>
			<staticText>
				<reportElement x="457" y="17" width="52" height="20" uuid="a2e6221d-f760-4252-8e8b-21410d696932"/>
				<textElement>
					<font fontName="Century Gothic" isBold="true"/>
				</textElement>
				<text><![CDATA[TOTAL]]></text>
			</staticText>
			<staticText>
				<reportElement x="366" y="17" width="29" height="20" uuid="e9e3f4fe-52a2-4c39-a217-a2e49218ede7"/>
				<textElement>
					<font fontName="Century Gothic" isBold="true"/>
				</textElement>
				<text><![CDATA[CI]]></text>
			</staticText>
			<staticText>
				<reportElement x="218" y="17" width="100" height="20" uuid="933da983-714d-4a47-a4ed-f8eeec111ce2"/>
				<textElement>
					<font fontName="Century Gothic" isBold="true"/>
				</textElement>
				<text><![CDATA[CLIENTE]]></text>
			</staticText>
			<staticText>
				<reportElement x="25" y="17" width="31" height="20" uuid="8f622755-5d5b-4372-ac76-e7d4ac1bc1ae"/>
				<textElement>
					<font fontName="Century Gothic" isBold="true"/>
				</textElement>
				<text><![CDATA[COD]]></text>
			</staticText>
			<staticText>
				<reportElement x="107" y="17" width="60" height="20" uuid="052d48a2-a7cf-4d97-a337-d1897ef2c104"/>
				<textElement>
					<font fontName="Century Gothic" isBold="true"/>
				</textElement>
				<text><![CDATA[FECHA]]></text>
			</staticText>
		</band>
	</pageHeader>
	<detail>
		<band height="35" splitType="Stretch">
			<rectangle>
				<reportElement x="1" y="2" width="555" height="32" uuid="6b57e4e4-c006-4212-b1d7-97a79773cc38"/>
			</rectangle>
			<textField>
				<reportElement x="24" y="10" width="31" height="20" uuid="f91a827b-9515-4f37-b580-e4aa9ee7156c"/>
				<textFieldExpression><![CDATA[$F{id}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="365" y="8" width="29" height="20" uuid="a7c751a9-8df4-4596-b2b2-73957e61d528"/>
				<textFieldExpression><![CDATA[$F{ci}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="217" y="10" width="100" height="20" uuid="6c308777-f4ae-4414-bf88-cca350eb9bbc"/>
				<textFieldExpression><![CDATA[$F{nombre}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="106" y="9" width="60" height="20" uuid="8b300fdb-d185-436d-9396-b75a46334326"/>
				<textFieldExpression><![CDATA[$F{fecha_formateada}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="456" y="8" width="66" height="20" uuid="a3b882a1-7cd1-48f1-9719-181439a8a5b9"/>
				<textFieldExpression><![CDATA[$F{total}]]></textFieldExpression>
			</textField>
		</band>
	</detail>
	<columnFooter>
		<band height="25">
			<rectangle>
				<reportElement x="394" y="0" width="161" height="20" uuid="29d04893-3eb8-489e-af9f-1c1c6530c6ac"/>
			</rectangle>
			<textField>
				<reportElement x="394" y="0" width="155" height="20" uuid="e7bcced9-d2ff-43f8-bf94-44e3930ddf67"/>
				<textElement textAlignment="Center" verticalAlignment="Middle"/>
				<textFieldExpression><![CDATA[$F{suma_total_ventas}]]></textFieldExpression>
			</textField>
		</band>
	</columnFooter>
	<summary>
		<band height="100"/>
	</summary>
</jasperReport>
